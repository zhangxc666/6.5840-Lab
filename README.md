## 6.824
### finish List（论文+CODE+DEBUG）
- Lab1  用时20h，4天
- Lab2A 用时28h，4天，500次测试无一FAIL
- Lab2B(屎山版v0) 用时3天，忘了多少小时，500次测试无一FAIL
- Lab2B(补丁版v1): 用时2天，15+小时，
  - [x] 修复了leader发送rpc，未收到reply时，还会继续执行一致性检查回退的bug
  - [x] 修复了leader收到reply的term>curTerm时，不更新curTerm的bug
  - [x] 删除了选举限制的更新resetTimerTicker的bug，原因是当前candidate不能成为leader
  - [x] 修复了当选leader和更新commitIndex的人数bug，应满足大于(len(rf.peers) >> 1)，即仅有两个人时，不能选举成功
  - [x] 修复了leader会提交之前term的日志的bug
- Lab2B(补丁版v2)，1天，10+h，5000次测试有两个FAIL（测试的问题，理论上没问题）
  - A → B，此时A接受一个命令，但是B还未收到，此时心跳没有到B，B超时，发起选举，之后经过选举限制，A会重新当选Leader，但无法提交之前term的日志，此时测试中也不会给新的命令，一直无法接下来的运行，因为测试中有的是仅当前commit了再向下提交新的命令，所有会一直卡在这里。但在现实情况中是不存在的，因为现实提交不需要等上一个log的commit。
  - [x] 修复了leader变成follower，仍然发心跳的bug
  - [x] 增加了心跳投票结束机制，当不回复心跳时，会自动结束协程，释放资源
  - [x] 增加了一致性检查优化算法
  - [x] 增加了选举过程结束后退出机制
  - [x] 修复出现选举限制后，即使args.Term > curTerm，leader和candidate也不会变成follower的bug
  - [x] 修复出现一致性冲突后，即使args.Term > curTerm，leader和candidate也不会变成follower的bug
- Lab2C(屎山版v0) 用时10h，主要解决2C和2B的bug。
  - [x] 修复了labBv2的一致性检查优化的bug，
  - [x] 修改了matchIndex更新机制，不采用max,同时仅在reply.success=true时再向下进行，否则可能会有数组越界问题，具体出现场景不明
- Lab2D(屎山版v0) 用时2天，15h，两千次测试无FAIL的，Lab2总用时大约为100h
- Lab3A(屎山版v0) 用时4天，30h，主要修Lab2的内容，500次测试无fail
  - [x] 修复了Lab2D中，快照InstallSnapshot响应的bug
  - [x] 增加了调用start后立即发送给follower发送心跳（会导致rpc乱序问题）
    - 可能会出现`[1,2,3,4]`先到，`[1,2,3]`后到的这种情况
  - [x] 修复了Lab2D中，由于rpc乱序问题，导致AppendEntries会删除新的log，被旧的rpc给覆盖
  - [x] 增加了sendInstallSnapshot的matchIndex和nextIndex更新机制
  - [x] 修复了在sendAppendEntries中，因为rpc乱序导致nextIndex更新错误的bug
  - [x] 修复了applyMsg在放到apply chan中的bug，可能会在并发情况下出现log被修改，导致越界或者顺序不一致等问题
- Lab3A(补丁版v1) 同时1天，主要搜集资料
  - [x] 修复了关闭channel未加锁的bug
  - [x] 修复了channel关闭后，再次关闭的bug
    - 多次测试仍然有bug，原因是因为关闭一个已经关闭的channel，出现这种情况的原因可能是因为client->leader发起一个请求，此时leader变成follower了无法给client响应，过了一会又重新当选leader，此时client又重新给这个leader发起请求，由于都是相同的index，且上一个channel还在等待结果，最终就造成了两次rpc请求都对应着同一个channel，所以可能会出现多次关闭的情况。对此这种情况的解决办法是，仅通知当前term的命令，之前的命令就不会通知给client了，让之前的接受命令的rpc超时即可
- Lab3B(屎山版v0) 用时2天，20+h。仍然会有百分之一的概率出现bug，具体原因不明，应该是raft层的bug，暂时不修复了。。。
  - [x] 异步提交执行结果给通道，增加并发度
  - [x] 修改了raft的选举时间和心跳时间
  - [x] 将结果返回给rpc时加锁
- Lab3B(补丁版v1) 用时1天，8h 1500次测试无FAIL，完美！！
  - 修复了一致性检查的bug，当args.PrevLogIndex > rf.lastLogIndex时，conflictIndex应该为rf.lastLogIndex+1
  - 修复了AppendEntries中对于args.PrevLogIndex < rf.lastIncludeIndex讨论错误的bug，需要特判args.PrevLogIndex < rf.lastIncludeIndex这种情况特殊处理
  